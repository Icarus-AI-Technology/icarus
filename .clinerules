# .clinerules - Regras de Desenvolvimento ICARUS v5.0

## ğŸ¯ Objetivo

Garantir cÃ³digo consistente, performÃ¡tico e manutenÃ­vel no ICARUS ERP.

---

## ğŸ“ Regras Gerais

### TypeScript

```typescript
// âœ… BOM
interface Produto {
  id: string
  nome: string
  preco: number
}

function getProduto(id: string): Promise<Produto> {
  return supabase.from('produtos').select('*').eq('id', id).single()
}

// âŒ RUIM
function getProduto(id: any): any {
  return supabase.from('produtos').select('*').eq('id', id).single()
}
```

**Regras**:
- âŒ **NUNCA** usar `any`
- âœ… Definir interfaces explÃ­citas
- âœ… Tipos de retorno obrigatÃ³rios em funÃ§Ãµes
- âœ… Strict mode habilitado

---

### Componentes React

```tsx
// âœ… BOM - Functional + TypeScript
interface ButtonProps {
  variant?: 'default' | 'success' | 'danger'
  onClick: () => void
  children: React.ReactNode
}

export function Button({ variant = 'default', onClick, children }: ButtonProps) {
  return (
    <button className={cn('neu-soft', variantClass[variant])} onClick={onClick}>
      {children}
    </button>
  )
}

// âŒ RUIM - Class component
class Button extends React.Component {
  render() {
    return <button>{this.props.children}</button>
  }
}
```

**Regras**:
- âœ… Componentes funcionais + hooks
- âŒ Componentes de classe
- âœ… Props tipadas com interface
- âœ… Destructuring de props

---

### Design NeumÃ³rfico

```tsx
// âœ… BOM - Usando classes neumÃ³rficas
<Card className="neu-soft hover:neu-hover transition-all">
  <Button className="neu-soft">Salvar</Button>
</Card>

// âŒ RUIM - Sem efeito neumÃ³rfico
<Card className="shadow-lg">
  <Button>Salvar</Button>
</Card>
```

**Regras**:
- âœ… `neu-soft` em cards e botÃµes
- âœ… `neu-hover` em interaÃ§Ãµes
- âœ… `neu-inset` em inputs
- âœ… `transition-all` para suavidade

---

### Paleta de Cores

```tsx
// âœ… BOM - Usando cores do tema
<Button variant="primary">Salvar</Button>
<Button variant="success">Confirmar</Button>
<Button variant="danger">Excluir</Button>
<Button variant="warning">AtenÃ§Ã£o</Button>

// âŒ RUIM - Cores hardcoded
<button style={{ backgroundColor: '#ff0000' }}>Excluir</button>
```

**Paleta**:
- `primary`: `#6366F1` (Indigo)
- `success`: `#10B981` (Green)
- `warning`: `#F59E0B` (Amber)
- `danger`: `#EF4444` (Red)

---

### Performance

```tsx
// âœ… BOM - Lazy loading
const Dashboard = lazy(() => import('@/pages/Dashboard'))
const Produtos = lazy(() => import('@/pages/Produtos'))

// âœ… BOM - Memoization
const ExpensiveComponent = memo(({ data }) => {
  const computed = useMemo(() => heavyCalculation(data), [data])
  return <div>{computed}</div>
})

// âŒ RUIM - Tudo eager loaded
import Dashboard from '@/pages/Dashboard'
import Produtos from '@/pages/Produtos'
```

**Regras**:
- âœ… Lazy load de rotas
- âœ… `useMemo` para cÃ¡lculos pesados
- âœ… `useCallback` para funÃ§Ãµes passadas como props
- âœ… Code splitting automÃ¡tico (Vite)

---

### Acessibilidade

```tsx
// âœ… BOM - AcessÃ­vel
<button
  aria-label="Fechar modal"
  onClick={onClose}
  className="neu-soft"
>
  <X aria-hidden="true" />
</button>

// âŒ RUIM - NÃ£o acessÃ­vel
<div onClick={onClose}>
  <X />
</div>
```

**Regras**:
- âœ… `aria-label` em Ã­cones sem texto
- âœ… `<button>` para cliques, nÃ£o `<div>`
- âœ… NavegaÃ§Ã£o por teclado (Tab, Enter, Esc)
- âœ… Contraste mÃ­nimo 4.5:1 (WCAG AA)

---

### Estado e Data Fetching

```tsx
// âœ… BOM - React Query
import { useQuery } from '@tanstack/react-query'

function Produtos() {
  const { data, isLoading } = useQuery({
    queryKey: ['produtos'],
    queryFn: () => supabase.from('produtos').select('*')
  })

  if (isLoading) return <Loading />
  return <List items={data} />
}

// âŒ RUIM - useEffect manual
function Produtos() {
  const [data, setData] = useState([])

  useEffect(() => {
    supabase.from('produtos').select('*').then(setData)
  }, [])
}
```

**Regras**:
- âœ… React Query para server state
- âœ… Zustand para client state
- âŒ useEffect para fetching (use React Query)
- âœ… InvalidaÃ§Ã£o automÃ¡tica de cache

---

### Supabase

```typescript
// âœ… BOM - Tipos + Error handling
async function getProduto(id: string): Promise<Produto | null> {
  const { data, error } = await supabase
    .from('produtos')
    .select('*')
    .eq('id', id)
    .single()

  if (error) {
    console.error('Erro ao buscar produto:', error)
    return null
  }

  return data
}

// âŒ RUIM - Sem tipos, sem error handling
async function getProduto(id) {
  const { data } = await supabase.from('produtos').select('*').eq('id', id).single()
  return data
}
```

**Regras**:
- âœ… Sempre verificar `error`
- âœ… Usar tipos do `Database`
- âœ… Queries otimizadas (select apenas campos necessÃ¡rios)
- âœ… RLS habilitado (Row Level Security)

---

### Testes

```typescript
// âœ… BOM - Teste completo
describe('Button', () => {
  it('should render with correct variant', () => {
    render(<Button variant="success">Salvar</Button>)
    expect(screen.getByText('Salvar')).toHaveClass('bg-success')
  })

  it('should call onClick when clicked', () => {
    const onClick = jest.fn()
    render(<Button onClick={onClick}>Click</Button>)
    fireEvent.click(screen.getByText('Click'))
    expect(onClick).toHaveBeenCalledTimes(1)
  })
})
```

**Regras**:
- âœ… MÃ­nimo 65% coverage para PR
- âœ… Testar comportamento, nÃ£o implementaÃ§Ã£o
- âœ… E2E para fluxos crÃ­ticos
- âœ… Mocks para Supabase/APIs

---

### Commits

```bash
# âœ… BOM - Conventional Commits
git commit -m "feat(vendas): adicionar filtro avanÃ§ado de pedidos"
git commit -m "fix(auth): corrigir login com Google"
git commit -m "docs(readme): atualizar seÃ§Ã£o de deploy"

# âŒ RUIM
git commit -m "update"
git commit -m "fix bug"
```

**Formato**:
```
<tipo>(<escopo>): <descriÃ§Ã£o>

[corpo opcional]

[footer opcional]
```

**Tipos**:
- `feat` - Nova feature
- `fix` - Bug fix
- `docs` - DocumentaÃ§Ã£o
- `style` - FormataÃ§Ã£o
- `refactor` - RefatoraÃ§Ã£o
- `test` - Testes
- `chore` - ManutenÃ§Ã£o

---

### Estrutura de Arquivos

```
src/
â”œâ”€â”€ components/
â”‚   â”œâ”€â”€ ui/                  # Componentes reutilizÃ¡veis
â”‚   â”‚   â”œâ”€â”€ button.tsx
â”‚   â”‚   â””â”€â”€ card.tsx
â”‚   â”œâ”€â”€ layout/              # Layout global
â”‚   â”‚   â”œâ”€â”€ Sidebar.tsx
â”‚   â”‚   â””â”€â”€ Header.tsx
â”‚   â””â”€â”€ modules/             # MÃ³dulos de negÃ³cio
â”‚       â””â”€â”€ vendas/
â”‚           â”œâ”€â”€ Pedidos.tsx
â”‚           â””â”€â”€ Orcamentos.tsx
â”œâ”€â”€ lib/
â”‚   â”œâ”€â”€ supabase/
â”‚   â”‚   â”œâ”€â”€ client.ts        # Cliente Supabase
â”‚   â”‚   â””â”€â”€ types.ts         # Types do DB
â”‚   â””â”€â”€ utils.ts             # UtilitÃ¡rios
â”œâ”€â”€ hooks/
â”‚   â”œâ”€â”€ use-toast.ts
â”‚   â””â”€â”€ useIcarusBrain.ts
â””â”€â”€ pages/
    â”œâ”€â”€ Dashboard.tsx
    â””â”€â”€ Vendas.tsx
```

**Regras**:
- âœ… PascalCase para componentes
- âœ… camelCase para funÃ§Ãµes/variÃ¡veis
- âœ… kebab-case para arquivos CSS
- âœ… Um componente por arquivo

---

### SeguranÃ§a

```typescript
// âœ… BOM - SanitizaÃ§Ã£o
import DOMPurify from 'dompurify'

function Comment({ html }: { html: string }) {
  const clean = DOMPurify.sanitize(html)
  return <div dangerouslySetInnerHTML={{ __html: clean }} />
}

// âŒ RUIM - XSS vulnerability
function Comment({ html }) {
  return <div dangerouslySetInnerHTML={{ __html: html }} />
}
```

**Regras**:
- âœ… Sanitizar HTML de usuÃ¡rios
- âœ… Validar inputs (Zod)
- âœ… HTTPS only
- âœ… Secrets em variÃ¡veis de ambiente
- âŒ Nunca commitar `.env`

---

### Responsividade

```tsx
// âœ… BOM - Mobile-first
<div className="
  flex flex-col          /* mobile */
  md:flex-row           /* tablet+ */
  lg:gap-6              /* desktop+ */
">
  <Card className="w-full md:w-1/2" />
  <Card className="w-full md:w-1/2" />
</div>

// âŒ RUIM - Desktop-only
<div className="flex gap-6">
  <Card className="w-1/2" />
  <Card className="w-1/2" />
</div>
```

**Breakpoints Tailwind**:
- `sm`: 640px
- `md`: 768px
- `lg`: 1024px
- `xl`: 1280px
- `2xl`: 1536px

---

## âœ… Checklist PR

Antes de abrir Pull Request:

- [ ] `npm run lint` sem erros
- [ ] `npm run type-check` sem erros
- [ ] `npm test` com coverage â‰¥ 65%
- [ ] Design neumÃ³rfico aplicado
- [ ] Acessibilidade verificada
- [ ] Responsivo testado
- [ ] Commit messages seguem Conventional Commits
- [ ] `.env` nÃ£o commitado

---

**v5.0.3** | Release: 2025-11-15

ğŸ¯ **Siga estas regras rigorosamente para manter a qualidade do cÃ³digo!**
